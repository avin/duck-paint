{"version":3,"sources":["redux/modules/uiSettings/reducer.js","redux/modules/uiSettings/index.js","redux/modules/index.js","redux/configureStore.js","utils/focusEngine.js","utils/browser.js","index.js","components/pages/DrawPage/MobileControlHelper/styles.module.scss","redux/modules/uiSettings/actionTypes.js","components/pages/DrawPage/styles.module.scss","components/common/Spinner/styles.module.scss","components/layouts/MainLayout/Header/styles.module.scss","components/common/ButtonsSelect/styles.module.scss","components/layouts/MainLayout/styles.module.scss","components/pages/DrawPage/ControlPanel/styles.module.scss","components/pages/DrawPage/ControlPanel/OpenControl/styles.module.scss","components/pages/DrawPage/ControlHint/styles.module.scss","components/root/Root.js","components/common/LoadingPage/styles.module.scss","redux/modules/uiSettings/actions.js","components/common/ButtonsSelect/ButtonsSelect.js","components/common/SelectMode/SelectMode.js","components/layouts/MainLayout/Header/icons/duck.svg","components/layouts/MainLayout/Header/Header.js","components/common/Spinner/Spinner.js","components/common/LoadingPage/LoadingPage.js","components/layouts/MainLayout/MainLayout.js","components/pages/DrawPage/ControlPanel/OpenControl/icons/cog.svg","components/pages/DrawPage/ControlPanel/OpenControl/OpenControl.js","components/pages/DrawPage/ControlPanel/ControlPanel.js","utils/math3d.js","utils/perlin.js","components/pages/DrawPage/graphics/Brush.js","utils/url.js","components/pages/DrawPage/graphics/MainScene.js","components/pages/DrawPage/MobileControlHelper/MobileControlHelper.js","components/pages/DrawPage/ControlHint/icons/question.svg","components/pages/DrawPage/ControlHint/ControlHint.js","components/pages/DrawPage/DrawPage.js","utils/hooks.js","components/root/App.js"],"names":["initialState","controlPanelIsOpen","mode","reducer","state","action","produce","type","SET_UI_SETTINGS_VALUES","values","RESET_UI_SETTINGS","combineReducers","uiSettings","configureStore","enhancers","middleware","thunk","composedEnhancers","compose","applyMiddleware","store","createStore","rootReducer","TAB_KEY_CODE","FocusEngine","container","className","isRunning","handleKeyDown","e","which","reset","addEventListener","handleMouseDown","classList","add","this","remove","removeEventListener","window","isMobile","Android","navigator","userAgent","match","BlackBerry","iOS","Opera","Windows","any","document","documentElement","start","ReactDOM","render","Root","getElementById","module","exports","hot","setUiSettingsValues","ButtonsSelect","options","onSelect","currentValue","value","length","styles","buttonsGroup","map","label","key","cn","button","active","onClick","protoTypes","PropTypes","array","SelectMode","useSelector","dispatch","useDispatch","handleSelectMode","useCallback","_extends","Object","assign","target","i","arguments","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","transform","d","_ref","svgRef","title","props","x","y","viewBox","enableBackground","xmlSpace","fill","ref","ForwardRef","forwardRef","Header","header","logoIcon","colors","R","SPINNER_TRACK","getViewBox","strokeWidth","radius","viewBoxX","toFixed","viewBoxWidth","Spinner","size","headColor","trackColor","Math","max","min","STROKE_WIDTH","spinner","spinnerAnimation","width","height","spinnerTrack","stroke","spinnerHead","pathLength","strokeDasharray","strokeDashoffset","PATH_LENGTH","number","string","LoadingPage","loadingPage","data-testid","MainLayout","children","useState","mainLayout","content","_ref3","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","_ref10","_ref11","_ref12","_ref13","_ref14","_ref15","_ref16","_ref17","id","OpenControl","noop","isOpen","openControl","icon","bool","ControlPanel","handleTogglePanel","controlPanel","tmpVector1","BABYLON","Zero","tmpQuaternion1","rotateQuaternionByNormalChangeToRef","q","prevNormal","nextNormal","v1","v2","angle","acos","Dot","CrossToRef","RotationAxisToRef","setFromUnitVectorsToRef","isNaN","multiplyToRef","FromEulerVectorToRef","Grad","z","dot2","dot3","grad3","p","perm","Array","gradP","seed","floor","v","sqrt","fade","t","lerp","a","b","perlin2","X","Y","n00","n01","n10","n11","u","Brush","mainScene","withParticles","_isActive","minSpeed","maxSpeed","speed","index","_tmp","bPos","rayFrom","rayTo","ray","merge","init","brushSrc","scene","brushInitPointPosition","currentMeshOptions","brush","clone","brushMaterial","specularColor","diffuseColor","color","emissiveColor","scale","material","isPickable","generalNode","position","prevPosition","prevPrevPosition","rotationQuaternion","directedRotationQuaternion","rotationPivot","rayPilot","parent","cameraNode","direction","updateSpeedFactor","initParticles","particleSystem","particleTexture","emitter","color1","color2","colorDead","emitRate","tuneParticlesSystem","quatRot","isFreeModeActiveDrawing","speedDiff","speedFactor","driveCamera","fov","speedFactorX","playMode","particleEmitterType","minLifeTime","maxLifeTime","maxEmitPower","minSize","maxSize","direction1","direction2","minEmitBox","maxEmitBox","timeDiffXSpeed","timeDiff","SlerpToRef","LerpToRef","isPaused","updateInDriveMode","retry","activeKeys","mainMesh","time","angleDiff","isActive","KeyA","ArrowLeft","KeyD","ArrowRight","KeyW","ArrowUp","speedUp","speedDown","snakeMode","sin","cos","s1","s2","scaleToRef","addToRef","getAbsolutePosition","negateNextNormal","negate","normalizeToRef","origin","pickInfo","pickWithRay","pickMesh","hit","handlePickHit","drawPoint","diff","abs","moveDiff","val","canvas","setIsFreeModeActiveDrawing","activeCamera","attachControl","params","event","detachControl","handlePointerMove","pick","pointerX","pointerY","copyFrom","pickedPoint","subtractToRef","getNormal","r","RotationAxis","multiply","normalize","normal","quaternion","set","radians","setDirectionToRef","setEnabled","driveArcCamera","getUrlQueryParameterByName","name","url","location","href","replace","results","RegExp","exec","decodeURIComponent","colorPalette","MainScene","engine","mainLight","tick","isStopped","driveCameraMode","mainMeshesCatalogue","duck","fileName","meshIndex","rotation","PI","visualOptions","clearColor","totalBrushes","Number","lowGraphics","textureSize","actionManager","registerAction","OnKeyDownTrigger","sourceEvent","code","OnKeyUpTrigger","onPointerObservable","brushes","handlePointerUp","POINTERUP","handlePointerDown","POINTERDOWN","POINTERMOVE","meshId","ImportMeshAsync","meshes","bakeTransformIntoVertices","Scaling","RotationX","RotationY","RotationZ","drawTexture","meshDrawTexture","anisotropicFilteringLevel","context","getContext","fillStyle","fillRect","update","materialGround","diffuseTexture","specularPower","mainMashBackSide","backSideMaterial","sideOrientation","ClockWiseSideOrientation","alpha","subdivide","createOrUpdateSubmeshesOctree","freezeWorldMatrix","doNotSyncBoundingInfo","getTextureCoordinates","data","Uint8ClampedArray","dotSizeN2","dotSize","g","redDot","ImageData","putImageData","ctx","colorString","beginPath","arc","camera","cameraAcceleration","checkCollisions","inputs","clear","zoomOnFactor","freeCamera","lowerBetaLimit","upperBetaLimit","lowerRadiusLimit","upperRadiusLimit","useBouncingBehavior","pipeline","renderPipeline","chromaticAberrationEnabled","chromaticAberration","aberrationAmount","radialIntensity","fxaaEnabled","glowLayerEnabled","glowLayer","blurKernelSize","intensity","imageProcessingEnabled","imageProcessing","contrast","exposure","vignetteEnabled","vignetteWeight","vignetteStretch","vignetteCameraFov","depthOfFieldEnabled","depthOfField","focalLength","fStop","focusDistance","lensSize","grainEnabled","grain","animated","s","FromHexString","env","createDefaultEnvironment","enableGroundShadow","skyboxSize","groundSize","skyboxColor","rootMesh","skybox","initFreeCamera","initDriveCamera","initDriveArcCamera","applyRenderPipeline","cameraLight","initMainMesh","CreateBox","Translation","colorHex","push","initControl","setPlayMode","sceneInstrumentation","registerBeforeRender","registerAfterRender","_realTime","Date","now","_prevRealTime","globalPosition","handleChangePlayMode","resetActiveKeys","forEach","k","MobileControlHelper","mainSceneRef","handlePressUp","current","handleUnPressUp","handlePressLeft","handleUnPressLeft","handlePressRight","handleUnPressRight","topContent","role","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","bottomContent","object","cx","cy","style","ControlHint","DrawPage","isReady","setIsReady","canvasRef","useRef","engineRef","gamePaused","setGamePaused","modeRef","useEffect","async","preserveDrawingBuffer","stencil","runRenderLoop","handleWindowResize","resize","dispose","tabIsFocused","hasFocus","isFocused","setIsFocused","handleFocus","handleBlur","useWindowFocus","onKeyPress","keyPressHandler","preventDefault","changeDriveCameraMode","downHandler","handleClickPauseMessage","pause","focus","page","loadingOverlay","mainCanvas","tabIndex","pauseMessage","App","exact","path","component","to"],"mappings":"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","file":"static/js/main.320a4d12.chunk.js","sourcesContent":["import produce from 'immer';\nimport { SET_UI_SETTINGS_VALUES, RESET_UI_SETTINGS } from './actionTypes';\n\nconst initialState = {\n  controlPanelIsOpen: false,\n\n  mode: 'FREE' // FREE, DRIVE\n};\n\nexport default function reducer(state = initialState, action = {}) {\n  return produce(state, state => {\n    switch (action.type) {\n      case SET_UI_SETTINGS_VALUES: {\n        const { values } = action;\n        state = {\n          ...state,\n          ...values,\n        };\n        break;\n      }\n      case RESET_UI_SETTINGS: {\n        state = initialState;\n        break;\n      }\n\n      default:\n    }\n\n    return state;\n  });\n}\n","import reducer from './reducer';\n\nexport default reducer;\n","import { combineReducers } from 'redux';\nimport uiSettings from './uiSettings';\n\nexport default combineReducers({\n  uiSettings,\n});\n","import { createStore, applyMiddleware, compose } from 'redux';\nimport thunk from 'redux-thunk';\n\nimport rootReducer from './modules';\n\nconst configureStore = (initialState = {}) => {\n  const enhancers = [];\n  const middleware = [thunk];\n\n  if (process.env.NODE_ENV !== 'production') {\n    const devToolsExtension = window.__REDUX_DEVTOOLS_EXTENSION__;\n\n    if (typeof devToolsExtension === 'function') {\n      enhancers.push(devToolsExtension());\n    }\n  }\n\n  const composedEnhancers = compose(applyMiddleware(...middleware), ...enhancers);\n\n  const store = createStore(rootReducer, initialState, composedEnhancers);\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (module.hot) {\n      module.hot.accept('./modules', () => {\n        store.replaceReducer(rootReducer);\n      });\n    }\n  }\n\n  return store;\n};\n\nexport default configureStore;\n","const TAB_KEY_CODE = 9;\n\nclass FocusEngine {\n  isRunning = false;\n\n  container = null;\n\n  className = null;\n\n  constructor(container, className) {\n    this.container = container;\n    this.className = className;\n  }\n\n  isActive() {\n    return this.isRunning;\n  }\n\n  start() {\n    this.container.addEventListener('mousedown', this.handleMouseDown);\n    this.isRunning = true;\n  }\n\n  stop() {\n    this.reset();\n    this.isRunning = false;\n  }\n\n  reset() {\n    this.container.classList.remove(this.className);\n    this.container.removeEventListener('keydown', this.handleKeyDown);\n    this.container.removeEventListener('mousedown', this.handleMouseDown);\n  }\n\n  handleKeyDown = e => {\n    if (e.which === TAB_KEY_CODE) {\n      this.reset();\n      this.container.addEventListener('mousedown', this.handleMouseDown);\n    }\n  };\n\n  handleMouseDown = () => {\n    this.reset();\n    this.container.classList.add(this.className);\n    this.container.addEventListener('keydown', this.handleKeyDown);\n  };\n}\n\nexport default FocusEngine;\n","import FocusEngine from './focusEngine';\n\n/**\n * Выставить надстройки окружения в браузере для комфортной работы\n */\nexport function prepareBrowserEnv() {\n  // Делаем фокус только по табу\n  const focusEngine = new FocusEngine(document.documentElement, 'focus-disabled');\n  focusEngine.start();\n}\n\n/**\n * Заинжектить скрипт на страницу\n * @param src\n */\nexport function injectJs(src) {\n  return new Promise((resolve, reject) => {\n    const head = document.getElementsByTagName('head')[0];\n    const script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.onload = () => {\n      resolve();\n    };\n    script.src = src;\n    head.appendChild(script);\n  });\n}\n\nwindow.isMobile = (() => {\n  const isMobile = {\n    Android() {\n      return navigator.userAgent.match(/Android/i);\n    },\n    BlackBerry() {\n      return navigator.userAgent.match(/BlackBerry/i);\n    },\n    iOS() {\n      return navigator.userAgent.match(/iPhone|iPad|iPod/i);\n    },\n    Opera() {\n      return navigator.userAgent.match(/Opera Mini/i);\n    },\n    Windows() {\n      return navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i);\n    },\n    any() {\n      return !!(\n        isMobile.Android() ||\n        isMobile.BlackBerry() ||\n        isMobile.iOS() ||\n        isMobile.Opera() ||\n        isMobile.Windows()\n      );\n    },\n  };\n\n  return isMobile.any();\n})();\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Root from './components/root/Root';\nimport './styles/index.scss';\nimport configureStore from './redux/configureStore';\nimport { prepareBrowserEnv } from '@/utils/browser';\n\nconst store = configureStore();\n\nprepareBrowserEnv();\n\nReactDOM.render(<Root store={store} />, document.getElementById('root'));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__38WTg\",\"topContent\":\"styles_topContent__2SqIy\",\"bottomContent\":\"styles_bottomContent__2li2d\",\"button\":\"styles_button__RdAQ7\"};","export const SET_UI_SETTINGS_VALUES = 'app/uiSettings/SET_UI_SETTINGS_VALUES';\nexport const RESET_UI_SETTINGS = 'app/uiSettings/RESET_UI_SETTINGS';\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"page\":\"styles_page__19w24\",\"mainCanvas\":\"styles_mainCanvas__kTjw6\",\"loadingOverlay\":\"styles_loadingOverlay__32MjQ\",\"pauseMessage\":\"styles_pauseMessage__2jkqI\",\"content\":\"styles_content__1QAy8\",\"pauseMessageAnimation\":\"styles_pauseMessageAnimation__TPE6V\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"spinner\":\"styles_spinner__9ROLI\",\"spinnerHead\":\"styles_spinnerHead__3b4D6\",\"spinnerAnimation\":\"styles_spinnerAnimation__1jvok\",\"spinner-animation\":\"styles_spinner-animation__k5LNj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"styles_header__1pWs-\",\"title\":\"styles_title__27VLp\",\"logoIcon\":\"styles_logoIcon__6pOFR\",\"logoAnimation\":\"styles_logoAnimation__3xzQE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buttonsGroup\":\"styles_buttonsGroup__xwX2i\",\"button\":\"styles_button__3noC7\",\"active\":\"styles_active__3H3vc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"mainLayout\":\"styles_mainLayout__3FuFV\",\"content\":\"styles_content__3eaLw\",\"header\":\"styles_header__32KBX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"controlPanel\":\"styles_controlPanel__2g10R\",\"isOpen\":\"styles_isOpen__2fJPj\",\"openControl\":\"styles_openControl__3VQ9D\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"openControl\":\"styles_openControl__15gw1\",\"icon\":\"styles_icon__30SGB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__2r-jB\",\"appearance\":\"styles_appearance__USu41\",\"icon\":\"styles_icon__1SBvQ\"};","import React from 'react';\nimport { Provider } from 'react-redux';\nimport { hot } from 'react-hot-loader';\nimport App from './App';\n\nconst Root = ({ store }) => {\n  return (\n    <Provider store={store}>\n      <App />\n    </Provider>\n  );\n};\n\nexport default hot(module)(Root);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loadingPage\":\"styles_loadingPage__qcS9u\"};","import { SET_UI_SETTINGS_VALUES, RESET_UI_SETTINGS } from './actionTypes';\n\n/**\n * Выставить настройки UI\n * @param values\n * @returns {{values: *, type: string}}\n */\nexport function setUiSettingsValues(values) {\n  return {\n    type: SET_UI_SETTINGS_VALUES,\n    values,\n  };\n}\n\n/**\n * Сброить все настройки UI для текущей сессии\n * @returns {{type: string}}\n */\nexport function resetUiSettings() {\n  return {\n    type: RESET_UI_SETTINGS,\n  };\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport cn from 'clsx';\nimport styles from './styles.module.scss';\n\nconst ButtonsSelect = ({ options = [], onSelect, value: currentValue }) => {\n  if (!options.length) {\n    return null;\n  }\n\n  return (\n    <div className={styles.buttonsGroup}>\n      {options.map(({ value, label }) => {\n        return (\n          <button\n            type=\"button\"\n            key={value}\n            className={cn(styles.button, { [styles.active]: value === currentValue })}\n            onClick={() => onSelect(value)}\n          >\n            {label}\n          </button>\n        );\n      })}\n    </div>\n  );\n};\n\nButtonsSelect.protoTypes = {\n  options: PropTypes.array,\n};\n\nexport default ButtonsSelect;\n","import React, { useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { setUiSettingsValues } from '@/redux/modules/uiSettings/actions';\nimport ButtonsSelect from '@/components/common/ButtonsSelect/ButtonsSelect';\n\nconst options = [\n  { label: 'Drive', value: 'DRIVE' },\n  { label: 'Paint', value: 'FREE' },\n];\n\nconst SelectMode = () => {\n  const mode = useSelector(state => state.uiSettings.mode);\n  const dispatch = useDispatch();\n\n  const handleSelectMode = useCallback(\n    mode => {\n      dispatch(\n        setUiSettingsValues({\n          mode,\n        }),\n      );\n    },\n    [dispatch],\n  );\n\n  return (\n    <div>\n      <ButtonsSelect options={options} onSelect={handleSelectMode} value={mode} />\n    </div>\n  );\n};\n\nSelectMode.protoTypes = {};\n\nexport default SelectMode;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"g\", null, React.createElement(\"g\", {\n  transform: \"translate(0.000000,511.000000) scale(0.100000,-0.100000)\"\n}, React.createElement(\"path\", {\n  d: \"M3455.5,4911c-730.9-104.8-1374.9-554.6-1725-1203.7c-109.9-207-237.7-339.9-347.6-368c-35.8-10.2-181.4-2.6-324.6,12.8c-557.1,61.3-858.7-92-940.5-477.9c-40.9-201.9-12.8-393.6,94.6-615.9C376,1908.2,866.7,1489.1,1457,1192.7c122.7-61.3,222.3-122.7,222.3-132.9c0-12.8-66.5-66.5-145.7-122.7c-480.4-329.7-920-943-1119.3-1553.8c-166.1-513.7-186.6-1183.2-51.1-1689.2c291.3-1104,1193.5-1934.6,2435.4-2248.9c506-127.8,1543.6-191.7,2292.4-143.1c1671.3,112.4,2875,564.8,3708.1,1395.3c518.8,518.8,851,1124.4,1006.9,1850.2c268.3,1231.8-51.1,2532.6-794.8,3235.3c-214.7,199.3-306.7,253-416.6,232.6c-102.2-20.4-173.8-94.6-355.2-373.1c-230-350.1-444.7-544.3-766.7-690C7018,748,6276.8,702,5627.7,837.4c-97.1,20.4-181.5,38.3-184,38.3c-35.8,0,25.6,107.3,184,319.4c370.6,493.2,480.4,805,483,1392.8c2.6,309.2-7.7,406.3-56.2,587.8c-207,771.8-779.5,1385.1-1525.7,1633C4163.4,4928.9,3815.8,4962.1,3455.5,4911z M3174.4,3178.3c109.9-48.6,255.6-199.3,296.5-301.6c40.9-107.3,28.1-334.8-28.1-439.6C3274,2102.4,2860,2030.9,2584,2286.5c-273.4,253-224.9,677.2,99.7,863.8C2842.2,3239.7,3015.9,3252.4,3174.4,3178.3z M8551.3-517c81.8-40.9,104.8-84.3,104.8-194.2c0-56.2-46-125.2-184-283.7c-935.3-1065.7-1896.2-1771-2806-2062.3c-408.9-130.4-615.9-163.6-1035-163.6c-431.9-2.5-690,38.3-1068.2,166.1c-383.3,127.8-1045.2,483-1180.7,633.8c-66.5,74.1-63.9,217.2,7.7,286.2c92,92,196.8,74.1,414-74.1c569.9-383.3,1213.9-595.4,1814.5-595.4c1144.9,0,2310.2,697.7,3608.5,2164.6C8375-473.6,8428.6-453.1,8551.3-517z\"\n})));\n\nvar SvgDuck = function SvgDuck(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 1000 1000\",\n    enableBackground: \"new 0 0 1000 1000\",\n    xmlSpace: \"preserve\",\n    fill: \"currentColor\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgDuck, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/duck.be9786c2.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react';\nimport cn from 'clsx';\nimport styles from './styles.module.scss';\nimport SelectMode from '@/components/common/SelectMode/SelectMode';\nimport { ReactComponent as LogoIcon } from './icons/duck.svg';\n\nconst Header = ({ className }) => {\n  return (\n    <div className={cn(styles.header, className)}>\n      <div className={styles.title}>\n        <LogoIcon className={styles.logoIcon} /> <div>Duck Paint</div>\n      </div>\n      <SelectMode />\n    </div>\n  );\n};\n\nexport default Header;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport cn from 'clsx';\nimport styles from './styles.module.scss';\n\nconst colors = {\n  red: '#d9822b',\n  gray: '#bfccd6',\n};\n\n// На базе http://stackoverflow.com/a/18473154/3124288\nconst R = 45;\nconst SPINNER_TRACK = `M 50,50 m 0,-${R} a ${R},${R} 0 1 1 0,${R * 2} a ${R},${R} 0 1 1 0,-${R *\n  2}`;\nconst PATH_LENGTH = 280;\n\nconst MIN_SIZE = 10;\nconst STROKE_WIDTH = 4;\nconst MIN_STROKE_WIDTH = 16;\n\nconst getViewBox = strokeWidth => {\n  const radius = R + strokeWidth / 2;\n  const viewBoxX = (50 - radius).toFixed(2);\n  const viewBoxWidth = (radius * 2).toFixed(2);\n  return `${viewBoxX} ${viewBoxX} ${viewBoxWidth} ${viewBoxWidth}`;\n};\n\nconst Spinner = ({ size = 50, headColor = colors.red, trackColor = colors.gray, className }) => {\n  size = Math.max(MIN_SIZE, size);\n\n  const strokeWidth = Math.min(MIN_STROKE_WIDTH, (STROKE_WIDTH * 100) / size);\n  const strokeOffset = PATH_LENGTH - PATH_LENGTH * 0.25;\n\n  return (\n    <div className={cn(styles.spinner, className)}>\n      <div className={styles.spinnerAnimation}>\n        <svg\n          width={size}\n          height={size}\n          strokeWidth={strokeWidth.toFixed(2)}\n          viewBox={getViewBox(strokeWidth)}\n        >\n          <path className={styles.spinnerTrack} d={SPINNER_TRACK} stroke={trackColor} />\n          <path\n            className={styles.spinnerHead}\n            d={SPINNER_TRACK}\n            pathLength={PATH_LENGTH}\n            strokeDasharray={`${PATH_LENGTH} ${PATH_LENGTH}`}\n            strokeDashoffset={strokeOffset}\n            stroke={headColor}\n          />\n        </svg>\n      </div>\n    </div>\n  );\n};\nSpinner.protoTypes = {\n  /** Размер круга */\n  size: PropTypes.number,\n\n  /** Цвет активного вращающегося элемента */\n  headColor: PropTypes.string,\n\n  /** Цвет круга (трека вращения) */\n  trackColor: PropTypes.string,\n};\n\nexport default Spinner;\n","import React from 'react';\nimport styles from './styles.module.scss';\nimport Spinner from '@/components/common/Spinner/Spinner';\n\nconst LoadingPage = () => {\n  return (\n    <div className={styles.loadingPage} data-testid=\"loading-page\">\n      <Spinner size={60} />\n    </div>\n  );\n};\n\nexport default LoadingPage;\n","import React, { useState } from 'react';\nimport Header from './Header/Header';\nimport styles from './styles.module.scss';\nimport LoadingPage from '@/components/common/LoadingPage/LoadingPage';\n\nconst MainLayout = ({ children }) => {\n  const [isReady] = useState(true);\n\n  if (!isReady) {\n    return <LoadingPage />;\n  }\n\n  return (\n    <div className={styles.mainLayout}>\n      <Header className={styles.header} />\n\n      <div className={styles.content}>{children}</div>\n    </div>\n  );\n};\n\nexport default MainLayout;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"g\", null, React.createElement(\"g\", null, React.createElement(\"g\", null, React.createElement(\"path\", {\n  d: \"M293.629,127.806l-5.795-13.739c19.846-44.856,18.53-46.189,14.676-50.08l-25.353-24.77l-2.516-2.12h-2.937 c-1.549,0-6.173,0-44.712,17.48l-14.184-5.719c-18.332-45.444-20.212-45.444-25.58-45.444h-35.765 c-5.362,0-7.446-0.006-24.448,45.606l-14.123,5.734C86.848,43.757,71.574,38.19,67.452,38.19l-3.381,0.105L36.801,65.032 c-4.138,3.891-5.582,5.263,15.402,49.425l-5.774,13.691C0,146.097,0,147.838,0,153.33v35.068c0,5.501,0,7.44,46.585,24.127 l5.773,13.667c-19.843,44.832-18.51,46.178-14.655,50.032l25.353,24.8l2.522,2.168h2.951c1.525,0,6.092,0,44.685-17.516 l14.159,5.758c18.335,45.438,20.218,45.427,25.598,45.427h35.771c5.47,0,7.41,0,24.463-45.589l14.195-5.74 c26.014,11,41.253,16.585,45.349,16.585l3.404-0.096l27.479-26.901c3.909-3.945,5.278-5.309-15.589-49.288l5.734-13.702 c46.496-17.967,46.496-19.853,46.496-25.221v-35.029C340.268,146.361,340.268,144.434,293.629,127.806z M170.128,228.474 c-32.798,0-59.504-26.187-59.504-58.364c0-32.153,26.707-58.315,59.504-58.315c32.78,0,59.43,26.168,59.43,58.315 C229.552,202.287,202.902,228.474,170.128,228.474z\"\n}))));\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref4 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref5 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref6 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref7 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref8 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref9 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref10 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref11 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref12 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref13 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref14 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref15 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref16 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref17 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar SvgCog = function SvgCog(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    id: \"Capa_1\",\n    viewBox: \"0 0 340.274 340.274\",\n    fill: \"currentColor\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10, _ref11, _ref12, _ref13, _ref14, _ref15, _ref16, _ref17);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgCog, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/cog.210a8d8a.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react';\nimport cn from 'clsx';\nimport noop from 'lodash/noop';\nimport PropTypes from 'prop-types';\nimport { ReactComponent as CogIcon } from './icons/cog.svg';\nimport styles from './styles.module.scss';\n\nconst OpenControl = ({ className, onClick = noop, isOpen }) => {\n  return (\n    <button\n      type=\"button\"\n      className={cn(styles.openControl, className, { [styles.isOpen]: isOpen })}\n      onClick={onClick}\n    >\n      <CogIcon className={cn(styles.icon)} />\n    </button>\n  );\n};\n\nOpenControl.protoTypes = {\n  isOpen: PropTypes.bool,\n};\n\nexport default OpenControl;\n","import React, { useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport { useDispatch } from 'react-redux';\nimport cn from 'clsx';\nimport styles from './styles.module.scss';\nimport { setUiSettingsValues } from '@/redux/modules/uiSettings/actions';\nimport OpenControl from './OpenControl/OpenControl';\n\nconst ControlPanel = ({ isOpen }) => {\n  const dispatch = useDispatch();\n\n  const handleTogglePanel = useCallback(() => {\n    dispatch(setUiSettingsValues({ controlPanelIsOpen: !isOpen }));\n  }, [isOpen, dispatch]);\n\n  return (\n    <div className={cn(styles.controlPanel, { [styles.isOpen]: isOpen })}>\n      ControlPanel here\n      <OpenControl className={styles.openControl} isOpen={isOpen} onClick={handleTogglePanel} />\n    </div>\n  );\n};\nControlPanel.protoTypes = {\n  isOpen: PropTypes.bool,\n};\n\nexport default ControlPanel;\n","import * as BABYLON from 'babylonjs';\nimport isNaN from 'lodash/isNaN';\n\n// ------- Временные и постоянные объекты ---------\n\nconst tmpVector1 = BABYLON.Vector3.Zero();\nconst tmpVector2 = BABYLON.Vector3.Zero();\nconst tmpVector3 = BABYLON.Vector3.Zero();\nconst tmpQuaternion1 = new BABYLON.Quaternion();\nconst startRotation = new BABYLON.Vector3(0, 1, 0);\n\n// ---------------------------\n\n/**\n *\n * @param v1\n * @param v2\n * @param ref\n */\nexport function setFromUnitVectorsToRef(v1, v2, ref) {\n  const angle = Math.acos(BABYLON.Vector3.Dot(v1, v2));\n  BABYLON.Vector3.CrossToRef(v1, v2, tmpVector1);\n  BABYLON.Quaternion.RotationAxisToRef(tmpVector1, angle, ref);\n}\n\n// ---------------------------\n\n/**\n *\n * @param mesh\n * @param normal\n */\nexport function setMeshRotationByNormalAndDirection(mesh, normal) {\n  BABYLON.Vector3.CrossToRef(startRotation, normal, tmpVector1);\n  BABYLON.Vector3.CrossToRef(tmpVector1, normal, tmpVector2);\n  BABYLON.Vector3.RotationFromAxisToRef(tmpVector2.negate(), normal, tmpVector1, tmpVector3);\n  BABYLON.Quaternion.RotationYawPitchRollToRef(\n    tmpVector3.y,\n    tmpVector3.x,\n    tmpVector3.z,\n    mesh.rotationQuaternion,\n  );\n}\n\n// ---------------------------\n\n/**\n *\n * @param q\n * @param prevNormal\n * @param nextNormal\n * @param ref\n */\nexport function rotateQuaternionByNormalChangeToRef(q, prevNormal, nextNormal, ref) {\n  if (!prevNormal) {\n    BABYLON.Quaternion.FromEulerVectorToRef(nextNormal, ref);\n  } else {\n    setFromUnitVectorsToRef(prevNormal, nextNormal, tmpQuaternion1);\n\n    if (!isNaN(tmpQuaternion1.x)) {\n      tmpQuaternion1.multiplyToRef(q, ref);\n    }\n  }\n}\n\n// ---------------------------\n\nexport function setDirectionToRef(normal, quaternion) {\n  quaternion = quaternion || new BABYLON.Quaternion();\n\n  tmpVector1.set(normal.z, 0, -normal.x).normalize();\n  const radians = Math.acos(normal.y);\n\n  quaternion = BABYLON.Quaternion.RotationAxisToRef(tmpVector1, radians, quaternion);\n\n  return quaternion;\n}\n","/* eslint-disable */\n\n/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */\n\nfunction Grad(x, y, z) {\n  this.x = x;\n  this.y = y;\n  this.z = z;\n}\n\nGrad.prototype.dot2 = function dot2(x, y) {\n  return this.x * x + this.y * y;\n};\n\nGrad.prototype.dot3 = function dot3(x, y, z) {\n  return this.x * x + this.y * y + this.z * z;\n};\n\nconst grad3 = [\n  new Grad(1, 1, 0),\n  new Grad(-1, 1, 0),\n  new Grad(1, -1, 0),\n  new Grad(-1, -1, 0),\n  new Grad(1, 0, 1),\n  new Grad(-1, 0, 1),\n  new Grad(1, 0, -1),\n  new Grad(-1, 0, -1),\n  new Grad(0, 1, 1),\n  new Grad(0, -1, 1),\n  new Grad(0, 1, -1),\n  new Grad(0, -1, -1),\n];\n\n// prettier-ignore\nconst p = [151, 160, 137, 91, 90, 15,\n  131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23,\n  190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33,\n  88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166,\n  77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244,\n  102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208, 89, 18, 169, 200, 196,\n  135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123,\n  5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42,\n  223, 183, 170, 213, 119, 248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9,\n  129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232, 178, 185, 112, 104, 218, 246, 97, 228,\n  251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249, 14, 239, 107,\n  49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254,\n  138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180];\n// To remove the need for index wrapping, double the permutation table length\nconst perm = new Array(512);\nconst gradP = new Array(512);\n\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\nexport function seed(seed) {\n  if (seed > 0 && seed < 1) {\n    // Scale the seed out\n    seed *= 65536;\n  }\n\n  seed = Math.floor(seed);\n  if (seed < 256) {\n    seed |= seed << 8;\n  }\n\n  for (let i = 0; i < 256; i++) {\n    let v;\n    if (i & 1) {\n      v = p[i] ^ (seed & 255);\n    } else {\n      v = p[i] ^ ((seed >> 8) & 255);\n    }\n\n    perm[i] = perm[i + 256] = v;\n    gradP[i] = gradP[i + 256] = grad3[v % 12];\n  }\n}\n\nseed(0);\n\n/*\n  for(var i=0; i<256; i++) {\n    perm[i] = perm[i + 256] = p[i];\n    gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n  }*/\n\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\nconst G2 = (3 - Math.sqrt(3)) / 6;\n\nconst F3 = 1 / 3;\nconst G3 = 1 / 6;\n\n// 2D simplex noise\nexport function simplex2(xin, yin) {\n  let n0, n1, n2; // Noise contributions from the three corners\n  // Skew the input space to determine which simplex cell we're in\n  const s = (xin + yin) * F2; // Hairy factor for 2D\n  let i = Math.floor(xin + s);\n  let j = Math.floor(yin + s);\n  const t = (i + j) * G2;\n  const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\n  const y0 = yin - j + t;\n  // For the 2D case, the simplex shape is an equilateral triangle.\n  // Determine which simplex we are in.\n  let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n  if (x0 > y0) {\n    // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n    i1 = 1;\n    j1 = 0;\n  } else {\n    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n    i1 = 0;\n    j1 = 1;\n  }\n  // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n  // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n  // c = (3-sqrt(3))/6\n  const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n  const y1 = y0 - j1 + G2;\n  const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n  const y2 = y0 - 1 + 2 * G2;\n  // Work out the hashed gradient indices of the three simplex corners\n  i &= 255;\n  j &= 255;\n  const gi0 = gradP[i + perm[j]];\n  const gi1 = gradP[i + i1 + perm[j + j1]];\n  const gi2 = gradP[i + 1 + perm[j + 1]];\n  // Calculate the contribution from the three corners\n  let t0 = 0.5 - x0 * x0 - y0 * y0;\n  if (t0 < 0) {\n    n0 = 0;\n  } else {\n    t0 *= t0;\n    n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\n  }\n  let t1 = 0.5 - x1 * x1 - y1 * y1;\n  if (t1 < 0) {\n    n1 = 0;\n  } else {\n    t1 *= t1;\n    n1 = t1 * t1 * gi1.dot2(x1, y1);\n  }\n  let t2 = 0.5 - x2 * x2 - y2 * y2;\n  if (t2 < 0) {\n    n2 = 0;\n  } else {\n    t2 *= t2;\n    n2 = t2 * t2 * gi2.dot2(x2, y2);\n  }\n  // Add contributions from each corner to get the final noise value.\n  // The result is scaled to return values in the interval [-1,1].\n  return 70 * (n0 + n1 + n2);\n}\n\n// 3D simplex noise\nexport function simplex3(xin, yin, zin) {\n  let n0, n1, n2, n3; // Noise contributions from the four corners\n\n  // Skew the input space to determine which simplex cell we're in\n  const s = (xin + yin + zin) * F3; // Hairy factor for 2D\n  let i = Math.floor(xin + s);\n  let j = Math.floor(yin + s);\n  let k = Math.floor(zin + s);\n\n  const t = (i + j + k) * G3;\n  const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\n  const y0 = yin - j + t;\n  const z0 = zin - k + t;\n\n  // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n  // Determine which simplex we are in.\n  let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n  let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n  if (x0 >= y0) {\n    if (y0 >= z0) {\n      i1 = 1;\n      j1 = 0;\n      k1 = 0;\n      i2 = 1;\n      j2 = 1;\n      k2 = 0;\n    } else if (x0 >= z0) {\n      i1 = 1;\n      j1 = 0;\n      k1 = 0;\n      i2 = 1;\n      j2 = 0;\n      k2 = 1;\n    } else {\n      i1 = 0;\n      j1 = 0;\n      k1 = 1;\n      i2 = 1;\n      j2 = 0;\n      k2 = 1;\n    }\n  } else {\n    if (y0 < z0) {\n      i1 = 0;\n      j1 = 0;\n      k1 = 1;\n      i2 = 0;\n      j2 = 1;\n      k2 = 1;\n    } else if (x0 < z0) {\n      i1 = 0;\n      j1 = 1;\n      k1 = 0;\n      i2 = 0;\n      j2 = 1;\n      k2 = 1;\n    } else {\n      i1 = 0;\n      j1 = 1;\n      k1 = 0;\n      i2 = 1;\n      j2 = 1;\n      k2 = 0;\n    }\n  }\n  // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n  // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n  // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n  // c = 1/6.\n  const x1 = x0 - i1 + G3; // Offsets for second corner\n  const y1 = y0 - j1 + G3;\n  const z1 = z0 - k1 + G3;\n\n  const x2 = x0 - i2 + 2 * G3; // Offsets for third corner\n  const y2 = y0 - j2 + 2 * G3;\n  const z2 = z0 - k2 + 2 * G3;\n\n  const x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\n  const y3 = y0 - 1 + 3 * G3;\n  const z3 = z0 - 1 + 3 * G3;\n\n  // Work out the hashed gradient indices of the four simplex corners\n  i &= 255;\n  j &= 255;\n  k &= 255;\n  const gi0 = gradP[i + perm[j + perm[k]]];\n  const gi1 = gradP[i + i1 + perm[j + j1 + perm[k + k1]]];\n  const gi2 = gradP[i + i2 + perm[j + j2 + perm[k + k2]]];\n  const gi3 = gradP[i + 1 + perm[j + 1 + perm[k + 1]]];\n\n  // Calculate the contribution from the four corners\n  let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\n  if (t0 < 0) {\n    n0 = 0;\n  } else {\n    t0 *= t0;\n    n0 = t0 * t0 * gi0.dot3(x0, y0, z0); // (x,y) of grad3 used for 2D gradient\n  }\n  let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\n  if (t1 < 0) {\n    n1 = 0;\n  } else {\n    t1 *= t1;\n    n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\n  }\n  let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\n  if (t2 < 0) {\n    n2 = 0;\n  } else {\n    t2 *= t2;\n    n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\n  }\n  let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\n  if (t3 < 0) {\n    n3 = 0;\n  } else {\n    t3 *= t3;\n    n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\n  }\n  // Add contributions from each corner to get the final noise value.\n  // The result is scaled to return values in the interval [-1,1].\n  return 32 * (n0 + n1 + n2 + n3);\n}\n\n// ##### Perlin noise stuff\n\nfunction fade(t) {\n  return t * t * t * (t * (t * 6 - 15) + 10);\n}\n\nfunction lerp(a, b, t) {\n  return (1 - t) * a + t * b;\n}\n\n// 2D Perlin Noise\nexport function perlin2(x, y) {\n  // Find unit grid cell containing point\n  let X = Math.floor(x),\n    Y = Math.floor(y);\n  // Get relative xy coordinates of point within that cell\n  x = x - X;\n  y = y - Y;\n  // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n  X = X & 255;\n  Y = Y & 255;\n\n  // Calculate noise contributions from each of the four corners\n  const n00 = gradP[X + perm[Y]].dot2(x, y);\n  const n01 = gradP[X + perm[Y + 1]].dot2(x, y - 1);\n  const n10 = gradP[X + 1 + perm[Y]].dot2(x - 1, y);\n  const n11 = gradP[X + 1 + perm[Y + 1]].dot2(x - 1, y - 1);\n\n  // Compute the fade curve value for x\n  const u = fade(x);\n\n  // Interpolate the four results\n  return lerp(lerp(n00, n10, u), lerp(n01, n11, u), fade(y));\n}\n\n// 3D Perlin Noise\nexport function perlin3(x, y, z) {\n  // Find unit grid cell containing point\n  let X = Math.floor(x),\n    Y = Math.floor(y),\n    Z = Math.floor(z);\n  // Get relative xyz coordinates of point within that cell\n  x = x - X;\n  y = y - Y;\n  z = z - Z;\n  // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n  X = X & 255;\n  Y = Y & 255;\n  Z = Z & 255;\n\n  // Calculate noise contributions from each of the eight corners\n  const n000 = gradP[X + perm[Y + perm[Z]]].dot3(x, y, z);\n  const n001 = gradP[X + perm[Y + perm[Z + 1]]].dot3(x, y, z - 1);\n  const n010 = gradP[X + perm[Y + 1 + perm[Z]]].dot3(x, y - 1, z);\n  const n011 = gradP[X + perm[Y + 1 + perm[Z + 1]]].dot3(x, y - 1, z - 1);\n  const n100 = gradP[X + 1 + perm[Y + perm[Z]]].dot3(x - 1, y, z);\n  const n101 = gradP[X + 1 + perm[Y + perm[Z + 1]]].dot3(x - 1, y, z - 1);\n  const n110 = gradP[X + 1 + perm[Y + 1 + perm[Z]]].dot3(x - 1, y - 1, z);\n  const n111 = gradP[X + 1 + perm[Y + 1 + perm[Z + 1]]].dot3(x - 1, y - 1, z - 1);\n\n  // Compute the fade curve value for x, y, z\n  const u = fade(x);\n  const v = fade(y);\n  const w = fade(z);\n\n  // Interpolate\n  return lerp(\n    lerp(lerp(n000, n100, u), lerp(n001, n101, u), w),\n    lerp(lerp(n010, n110, u), lerp(n011, n111, u), w),\n    v,\n  );\n}\n","import merge from 'lodash/merge';\nimport * as BABYLON from 'babylonjs';\nimport { rotateQuaternionByNormalChangeToRef, setDirectionToRef } from '@/utils/math3d';\nimport { perlin2 } from '@/utils/perlin';\n\nclass Brush {\n  // Объект главной сцены\n  mainScene = null;\n\n  // Использовать партиклы\n  withParticles = true;\n\n  // Кисть является основной\n  _isActive = false;\n\n  // Минимальная скорость\n  minSpeed = 2.25;\n\n  // Максимальная скорость\n  maxSpeed = 5;\n\n  // Текущая скорость\n  speed = this.minSpeed;\n\n  // Порядковый уникальный номер кисти (идентификатор)\n  index = 0;\n\n  // Хранилище под временные объекты для экономии памяти\n  // чтоб каждый раз не создавать объекты, будем использовать через\n  // Ref-методы BABYLON для присвоения значений к уже готовым объектам\n  _tmp = {\n    bPos: BABYLON.Vector3.Zero(),\n    rayFrom: BABYLON.Vector3.Zero(),\n    rayTo: BABYLON.Vector3.Zero(),\n    ray: new BABYLON.Ray(BABYLON.Vector3.Zero(), BABYLON.Vector3.Zero(), 1.2),\n  };\n\n  // Угол поворода (радианы)\n  angle = 0;\n\n  constructor(options) {\n    merge(this, options);\n\n    this.init();\n  }\n\n  init() {\n    const {\n      id,\n      brushSrc,\n      mainScene: {\n        scene,\n        currentMeshOptions: { brushInitPointPosition },\n      },\n    } = this;\n\n    const brush = brushSrc.clone(`brush-${id}`);\n\n    this.brush = brush;\n\n    const brushMaterial = new BABYLON.StandardMaterial('brush-material', scene);\n    brushMaterial.specularColor = new BABYLON.Color3(0, 0, 0);\n    brushMaterial.diffuseColor = this.color;\n    brushMaterial.emissiveColor = this.color.scale(0.75);\n    brush.material = brushMaterial;\n\n    // Кисти не учавствуют в рейкасте\n    brush.isPickable = false;\n\n    // Немного выделяем грани (чисто для декора)\n    // brush.enableEdgesRendering();\n    // brush.edgesWidth = 0.5;\n    // brush.edgesColor = BABYLON.Color4.FromColor3(this.color.scale(0.5), 0.5);\n\n    // Определяем направляющие.\n    // Направляющие содержат позицию и вращения которую должны приобрести\n    // связанные сущности через интерполяцию для гладкости происходящего\n\n    // Направляющая для кисти,\n    // хранит в себе данные полученные при рейкасте\n    this.generalNode = new BABYLON.TransformNode('general-node');\n    this.generalNode.position = new BABYLON.Vector3(\n      brushInitPointPosition[0],\n      brushInitPointPosition[1],\n      brushInitPointPosition[2],\n    );\n    this.generalNode.prevPosition = BABYLON.Vector3.Zero();\n    this.generalNode.prevPrevPosition = BABYLON.Vector3.Zero();\n    this.generalNode.rotationQuaternion = new BABYLON.Quaternion();\n    this.generalNode.directedRotationQuaternion = new BABYLON.Quaternion();\n\n    // Направляющая для вращения прицела для луча\n    this.rotationPivot = new BABYLON.TransformNode('rotation-pivot');\n    this.rotationPivot.position = BABYLON.Vector3.Zero();\n\n    // Сам прицел для луча\n    this.rayPilot = new BABYLON.TransformNode('rayPilot');\n    this.rayPilot.parent = this.rotationPivot;\n    this.rayPilot.position = new BABYLON.Vector3(1, 0, 1);\n\n    // Направляющая для камеры\n    this.cameraNode = new BABYLON.TransformNode('camera-node');\n    this.cameraNode.position = brush.position.clone();\n    this.cameraNode.rotationQuaternion = new BABYLON.Quaternion();\n\n    // Инициализируем положение кисти через направляющую\n    brush.parent = this.generalNode;\n    brush.position = new BABYLON.Vector3.Zero();\n    brush.rotationQuaternion = new BABYLON.Quaternion();\n\n    this.prevPosition = this.generalNode.position;\n    this.direction = new BABYLON.Vector3.Zero();\n\n    // Инициализируем вспомогательные значения для перемещения\n    this.reset();\n    this.updateSpeedFactor();\n\n    // Включаем частицы\n    if (this.withParticles) {\n      this.initParticles();\n    }\n  }\n\n  initParticles() {\n    // Create a particle system\n    const particleSystem = new BABYLON.ParticleSystem('particles', 2000, this.mainScene.scene);\n    this.particleSystem = particleSystem;\n\n    particleSystem.particleTexture = new BABYLON.Texture(\n      'static/assets/textures/flare.png',\n      this.mainScene.scene,\n    );\n\n    particleSystem.emitter = this.generalNode; // the starting object, the emitter\n\n    particleSystem.color1 = this.color;\n    particleSystem.color2 = new BABYLON.Color4(0.92, 0.15, 0.0, 1.0);\n    particleSystem.colorDead = new BABYLON.Color4(0, 0, 0.0, 1);\n\n    particleSystem.emitRate = 0;\n\n    // Выставляем зависимые значения\n    this.tuneParticlesSystem();\n\n    // Start the particle system\n    particleSystem.start();\n  }\n\n  get isActive() {\n    return this._isActive;\n  }\n\n  set isActive(val) {\n    if (val) {\n      this.mainScene.driveCamera.parent = this.cameraNode;\n\n      this.mainScene.driveArcCamera.target = this.cameraNode.position;\n    }\n\n    // eslint-disable-next-line no-underscore-dangle\n    this._isActive = val;\n  }\n\n  reset() {\n    this.prevNormal = null;\n    this.nextNormal = null;\n    this.quatRot = null;\n    this.isFreeModeActiveDrawing = false;\n  }\n\n  speedUp() {\n    if (this.speed === this.maxSpeed) {\n      return;\n    }\n\n    const speedDiff = (this.maxSpeed - this.minSpeed) / 100;\n\n    this.speed += speedDiff;\n    this.speed = Math.min(this.speed, this.maxSpeed);\n    this.speed = Math.max(this.speed, this.minSpeed);\n\n    this.updateSpeedFactor();\n    this.tuneParticlesSystem();\n  }\n\n  speedDown() {\n    if (this.speed === this.minSpeed) {\n      return;\n    }\n\n    const speedDiff = (this.maxSpeed - this.minSpeed) / 100;\n\n    this.speed -= speedDiff;\n    this.speed = Math.min(this.speed, this.maxSpeed);\n    this.speed = Math.max(this.speed, this.minSpeed);\n\n    this.updateSpeedFactor();\n    this.tuneParticlesSystem();\n  }\n\n  updateSpeedFactor() {\n    this.speedFactor = (this.speed - this.minSpeed) / (this.maxSpeed - this.minSpeed);\n\n    this.mainScene.driveCamera.fov = 0.8 + this.speedFactor * 0.5;\n  }\n\n  /**\n   * Выставить зависимые от скорости значения для системы частиц\n   */\n  tuneParticlesSystem() {\n    if (!this.withParticles) {\n      return;\n    }\n\n    const { particleSystem } = this;\n\n    let speedFactorX;\n\n    if (this.mainScene.playMode === 'DRIVE') {\n      speedFactorX = Math.max(0.25, this.speedFactor) - 0.6;\n    } else if (this.mainScene.playMode === 'FREE') {\n      if (this.isFreeModeActiveDrawing) {\n        speedFactorX = 0.6;\n      } else {\n        speedFactorX = 0;\n      }\n    }\n\n    particleSystem.emitRate = 5500 * speedFactorX;\n    particleSystem.particleEmitterType = new BABYLON.BoxParticleEmitter(1);\n\n    particleSystem.minLifeTime = 0.05;\n    particleSystem.maxLifeTime = 0.4;\n\n    particleSystem.maxEmitPower = speedFactorX * 2 * 5;\n\n    particleSystem.minSize = 0.1;\n    particleSystem.maxSize = speedFactorX * 0.5;\n\n    particleSystem.direction1 = new BABYLON.Vector3(-1, -1, -1);\n    particleSystem.direction2 = new BABYLON.Vector3(1, 1, 1);\n\n    particleSystem.minEmitBox = new BABYLON.Vector3(-0.25, -0.075, -0.25);\n    particleSystem.maxEmitBox = new BABYLON.Vector3(0.25, 0.075, 0.25);\n\n    particleSystem.minEmitBox = new BABYLON.Vector3.Zero();\n    particleSystem.maxEmitBox = new BABYLON.Vector3.Zero();\n  }\n\n  update() {\n    const {\n      brush,\n      mainScene: { playMode, timeDiff },\n    } = this;\n\n    const timeDiffXSpeed = timeDiff * this.speed;\n\n    this.tuneParticlesSystem();\n\n    BABYLON.Quaternion.SlerpToRef(\n      brush.rotationQuaternion,\n      this.generalNode.directedRotationQuaternion,\n      timeDiffXSpeed * 6,\n      brush.rotationQuaternion,\n    );\n\n    BABYLON.Quaternion.SlerpToRef(\n      this.cameraNode.rotationQuaternion,\n      this.generalNode.directedRotationQuaternion,\n      timeDiffXSpeed,\n      this.cameraNode.rotationQuaternion,\n    );\n    BABYLON.Vector3.LerpToRef(\n      this.cameraNode.position,\n      this.generalNode.position,\n      timeDiffXSpeed * 2,\n      this.cameraNode.position,\n    );\n\n    if (playMode === 'DRIVE') {\n      if (!this.mainScene.isPaused) {\n        this.updateInDriveMode();\n      }\n    }\n  }\n\n  /**\n   * Обновление кисти в режиме DRIVE\n   */\n  updateInDriveMode(retry = 0) {\n    const { mainScene } = this;\n\n    const { activeKeys, scene, mainMesh, timeDiff, time } = mainScene;\n\n    const angleDiff = 0.02 + 0.3 / (this.speed * 3);\n\n    if (this.isActive) {\n      if (activeKeys.KeyA || activeKeys.ArrowLeft) {\n        this.angle -= angleDiff;\n      }\n      if (activeKeys.KeyD || activeKeys.ArrowRight) {\n        this.angle += angleDiff;\n      }\n      if (activeKeys.KeyW || activeKeys.ArrowUp) {\n        this.speedUp();\n      } else {\n        this.speedDown();\n      }\n    } else {\n      this.angle += angleDiff * perlin2(this.index * 100, this.mainScene.time);\n    }\n\n    // Режим змеи, движения туда-сюда ползем как змея\n    if (this.snakeMode) {\n      this.angle += Math.sin(time * 20) * 0.08;\n    }\n\n    // ----------------------------------------------------\n\n    // Cчитаем боковое отклонение для стреляющего луча\n    this.rayPilot.position.x = Math.sin(this.angle + retry * 0.3);\n    this.rayPilot.position.z = Math.cos(this.angle + retry * 0.3);\n\n    // Определяющие для положения стреляющего луча\n    const s1 = this.speed * timeDiff * (2 + retry * 0.25); // высота точки выстрела луча над поверхностью\n    const s2 = this.speed * timeDiff; // шаг/отдаление от текущей позиции\n\n    if (!this.nextNormal) {\n      this.nextNormal = new BABYLON.Vector3(0, 1, 0);\n    }\n\n    const {\n      _tmp: { rayFrom, rayTo, ray, bPos },\n    } = this;\n\n    // Поднимаемся над поверхностью в направление вектора нормали на высоту s1\n    this.nextNormal.scaleToRef(s1, bPos);\n\n    // Прибавляем позиции в направлении вращения на велицину шага s2\n    bPos.addToRef(this.rayPilot.getAbsolutePosition().scale(s2), bPos);\n\n    // Позиционируем на мировоую координату по текущей позиции направляющей\n    bPos.addToRef(this.generalNode.position, rayFrom);\n\n    const negateNextNormal = this.nextNormal.negate();\n    bPos.addToRef(negateNextNormal, rayTo);\n    rayTo.normalizeToRef(rayTo);\n\n    ray.origin = rayFrom;\n    ray.direction = rayTo;\n\n    const pickInfo = scene.pickWithRay(ray, pickMesh => {\n      return pickMesh === mainMesh;\n    });\n\n    if (pickInfo.hit) {\n      this.handlePickHit(pickInfo);\n\n      this.rotationPivot.rotationQuaternion = this.quatRot;\n\n      mainScene.drawPoint(pickInfo, this.color);\n    }\n\n    if (this.generalNode.prevPrevPosition) {\n      const { prevPrevPosition, position } = this.generalNode;\n\n      const diff =\n        Math.abs(position.x - prevPrevPosition.x) +\n        Math.abs(position.y - prevPrevPosition.y) +\n        Math.abs(position.z - prevPrevPosition.z);\n\n      // Если движения нет - вероятно застряли - делаем попытку выбраться (не больше 10 раз)\n      if (diff === this.moveDiff) {\n        if (retry < 10) {\n          this.updateInDriveMode(retry + 1);\n        }\n      }\n\n      this.moveDiff = diff;\n    }\n  }\n\n  // updateInFreeMode() {\n  //   //\n  // }\n\n  setIsFreeModeActiveDrawing(val) {\n    this.isFreeModeActiveDrawing = val;\n\n    this.tuneParticlesSystem();\n  }\n\n  handlePointerUp() {\n    const {\n      mainScene: { scene, canvas },\n    } = this;\n\n    this.setIsFreeModeActiveDrawing(false);\n\n    scene.activeCamera.attachControl(canvas, true);\n  }\n\n  handlePointerDown(params) {\n    const { event, pickInfo } = params;\n\n    // Только на левую кнопку\n    if (event.button !== 0) {\n      return;\n    }\n\n    const {\n      mainScene: { scene, canvas },\n    } = this;\n\n    // Только если кликнули по утке\n    if (pickInfo.hit) {\n      this.setIsFreeModeActiveDrawing(true);\n\n      scene.activeCamera.detachControl(canvas);\n    }\n\n    this.handlePointerMove(params);\n  }\n\n  handlePointerMove({ pickInfo }) {\n    const {\n      mainScene: { scene },\n    } = this;\n\n    pickInfo = scene.pick(scene.pointerX, scene.pointerY);\n\n    if (pickInfo.hit) {\n      this.handlePickHit(pickInfo);\n\n      if (this.isFreeModeActiveDrawing) {\n        this.mainScene.drawPoint(pickInfo, this.color);\n      }\n    }\n  }\n\n  handlePickHit(pickInfo) {\n    this.generalNode.prevPrevPosition.copyFrom = this.generalNode.prevPosition;\n    this.generalNode.prevPosition.copyFrom(this.generalNode.position);\n    this.generalNode.position.copyFrom(pickInfo.pickedPoint);\n\n    this.generalNode.position.subtractToRef(this.prevPosition, this.direction);\n    this.direction.normalizeToRef(this.direction);\n\n    this.prevNormal = this.nextNormal;\n    this.nextNormal = pickInfo.getNormal();\n\n    if (!this.quatRot) {\n      this.quatRot = setDirectionToRef(this.nextNormal, this.quatRot);\n    } else {\n      rotateQuaternionByNormalChangeToRef(\n        this.quatRot,\n        this.prevNormal,\n        this.nextNormal,\n        this.quatRot,\n      );\n\n      const r = BABYLON.Quaternion.RotationAxis(new BABYLON.Vector3(0, 1, 0), this.angle);\n\n      this.generalNode.directedRotationQuaternion = this.quatRot.multiply(r).normalize();\n    }\n  }\n\n  handleChangePlayMode(playMode) {\n    switch (playMode) {\n      case 'DRIVE': {\n        // Делаем все кисти видимыми\n        this.brush.setEnabled(true);\n        break;\n      }\n      case 'FREE': {\n        // Видимой оставляем только активную кисть\n        if (this.isActive) {\n          this.brush.setEnabled(true);\n        } else {\n          this.brush.setEnabled(false);\n        }\n        break;\n      }\n      default:\n    }\n  }\n}\n\nexport default Brush;\n","import forOwn from 'lodash/forOwn';\n\n/**\n * Получение значения query параметра\n * @param name\n * @param url\n * @returns {*}\n */\nexport function getUrlQueryParameterByName(name, url = window.location.href) {\n  name = name.replace(/[[\\]]/g, '\\\\$&');\n  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`);\n  const results = regex.exec(url);\n  if (!results) {\n    return null;\n  }\n  if (!results[2]) {\n    return '';\n  }\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n}\n\n/**\n * Перевести объект в строку query-параметров для get-запросов\n * @param obj\n * @param keepEmpty - сохранять элементы со значеием null и undefined\n * @returns {string}\n */\nexport function objectToQueryString(obj, keepEmpty = false) {\n  const results = [];\n  forOwn(obj, (value, key) => {\n    if (!keepEmpty && (value === null || value === undefined)) {\n      return;\n    }\n    if (Array.isArray(value)) {\n      forOwn(value, value => {\n        results.push(`${key}[]=${encodeURIComponent(value)}`);\n      });\n    } else {\n      results.push(`${key}=${encodeURIComponent(value)}`);\n    }\n  });\n  return results.join('&');\n}\n","import * as BABYLON from 'babylonjs';\nimport merge from 'lodash/merge';\nimport Brush from '@/components/pages/DrawPage/graphics/Brush';\nimport { getUrlQueryParameterByName } from '@/utils/url';\n\n// Основная палитра, отсюда будем брать все цвета\nconst colorPalette = [\n  '#08141e',\n  '#1D2B53',\n  '#7E2553',\n  '#008751',\n  '#AB5236',\n  '#5F574F',\n  '#C2C3C7',\n  '#FFF1E8',\n  '#FF004D',\n  '#FFA300',\n  '#FFEC27',\n  '#00E436',\n  '#29ADFF',\n  '#83769C',\n  '#FF77A8',\n  '#FFCCAA',\n];\n\nclass MainScene {\n  // Основной движок BABYLON\n  engine = null;\n\n  // Сцена BABYLON на которой всё происходит\n  scene = null;\n\n  // Текущий игровой режим (DRIVE / FREE)\n  playMode = 'DRIVE';\n\n  // Основной свет сцены\n  mainLight = null;\n\n  // Текущие нажатые кнопки\n  activeKeys = {};\n\n  // Время проведенное в рендере\n  time = 0;\n\n  // Разница во времени между последними кадрами\n  timeDiff = 0;\n\n  // Текущий кадр\n  tick = 0;\n\n  // Остановлен рендер\n  isStopped = false;\n\n  // Остановлено перемещение фигур\n  isPaused = false;\n\n  // Режим камеры для езды\n  driveCameraMode = 'CLASSIC';\n\n  // Каталог доступных главных фигур\n  mainMeshesCatalogue = {\n    duck: {\n      id: 'duck',\n      location: 'static/assets/scenes/',\n      fileName: 'duck.obj',\n      meshIndex: 0,\n      scale: [10, 10, 10],\n      rotation: [0, -Math.PI, 0],\n      brushInitPointPosition: [-6.223477418636669, 4.193322954756397, 0.13768080415772133],\n    },\n  };\n\n  // Визуальные настройки\n  visualOptions = {\n    // Цвет фона\n    clearColor: colorPalette[0],\n  };\n\n  constructor(options) {\n    // Подменяем текущий дефолт\n    merge(this, options);\n\n    this.totalBrushes = Number(getUrlQueryParameterByName('count')) || 5;\n    this.totalBrushes = Math.max(0, this.totalBrushes) + 1;\n\n    this.lowGraphics = Number(getUrlQueryParameterByName('low')) || 0;\n\n    if (window.isMobile) {\n      this.lowGraphics = 1;\n    }\n\n    this.textureSize = Number(getUrlQueryParameterByName('size')) || 0;\n    if (!this.textureSize) {\n      this.textureSize = window.isMobile ? 2000 : 4000;\n    }\n  }\n\n  /**\n   * Инициализация управления\n   */\n  initControl() {\n    const { scene } = this;\n\n    scene.actionManager = new BABYLON.ActionManager(scene);\n    scene.actionManager.registerAction(\n      new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, e => {\n        this.activeKeys[e.sourceEvent.code] = true;\n      }),\n    );\n    scene.actionManager.registerAction(\n      new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, e => {\n        this.activeKeys[e.sourceEvent.code] = false;\n      }),\n    );\n\n    scene.onPointerObservable.add(e => {\n      if (this.playMode === 'FREE') {\n        this.brushes[0].handlePointerUp(e);\n      }\n    }, BABYLON.PointerEventTypes.POINTERUP);\n\n    scene.onPointerObservable.add(e => {\n      if (this.playMode === 'FREE') {\n        this.brushes[0].handlePointerDown(e);\n      }\n    }, BABYLON.PointerEventTypes.POINTERDOWN);\n\n    scene.onPointerObservable.add(e => {\n      if (this.playMode === 'FREE') {\n        this.brushes[0].handlePointerMove(e);\n      }\n    }, BABYLON.PointerEventTypes.POINTERMOVE);\n  }\n\n  /**\n   * Инициализация главной фигуры (по которой ездим)\n   * @param meshId - id загружаемой фигуры (из this.mainMeshesCatalogue)\n   */\n  async initMainMesh(meshId) {\n    this.currentMeshOptions = this.mainMeshesCatalogue[meshId];\n\n    const { location, fileName, meshIndex, scale, rotation } = this.currentMeshOptions;\n\n    // Грузим модельку\n    const { meshes } = await BABYLON.SceneLoader.ImportMeshAsync(\n      null,\n      location,\n      fileName,\n      this.scene,\n    );\n    const mainMesh = meshes[meshIndex];\n    this.mainMesh = mainMesh;\n\n    // Подгоняем модель под оптимальные размеры\n    mainMesh.bakeTransformIntoVertices(BABYLON.Matrix.Scaling(scale[0], scale[1], scale[2]));\n    if (rotation[0]) {\n      mainMesh.bakeTransformIntoVertices(BABYLON.Matrix.RotationX(rotation[0]));\n    }\n    if (rotation[1]) {\n      mainMesh.bakeTransformIntoVertices(BABYLON.Matrix.RotationY(rotation[1]));\n    }\n    if (rotation[2]) {\n      mainMesh.bakeTransformIntoVertices(BABYLON.Matrix.RotationZ(rotation[2]));\n    }\n\n    // Создаем текстуру на которой будем рисовать\n    const drawTexture = new BABYLON.DynamicTexture(\n      'paint-texture',\n      { width: this.textureSize, height: this.textureSize },\n      this.scene,\n    );\n    this.meshDrawTexture = drawTexture;\n    this.meshDrawTexture.anisotropicFilteringLevel = 0;\n    {\n      // Заливаем текстуру почти белым цветом\n      const context = drawTexture.getContext();\n      context.fillStyle = 'hsl(0, 0%, 98%)';\n      context.fillRect(0, 0, this.textureSize, this.textureSize);\n      drawTexture.update(false);\n    }\n\n    // Создаем основной материал для фигуры\n    const materialGround = new BABYLON.StandardMaterial('front-side-material', this.scene);\n    materialGround.emissiveColor = new BABYLON.Color3(0.35, 0.4, 0.4);\n    materialGround.diffuseTexture = drawTexture;\n    materialGround.specularPower = 1000.0;\n    materialGround.specularColor = new BABYLON.Color3(0.25, 0.25, 0.25);\n\n    mainMesh.material = materialGround;\n\n    // Делаем копию фигуры для обратной поверхности\n    const mainMashBackSide = mainMesh.clone('main-mash-back-side');\n    this.mainMashBackSide = mainMashBackSide;\n\n    // Делаем материал для изнанки (прозрачный и с текстурой как на фронтальной поверхности)\n    const backSideMaterial = new BABYLON.StandardMaterial('back-side-material', this.scene);\n    backSideMaterial.sideOrientation = BABYLON.Material.ClockWiseSideOrientation;\n    backSideMaterial.specularColor = new BABYLON.Color3(0.0, 0.0, 0.0);\n    backSideMaterial.emissiveColor = new BABYLON.Color3(0.15, 0.2, 0.2);\n    backSideMaterial.diffuseTexture = drawTexture;\n    backSideMaterial.alpha = 0.6;\n    mainMashBackSide.material = backSideMaterial;\n\n    mainMashBackSide.isPickable = false;\n\n    // ---------- Оптимизация ----------\n\n    // Делаем дерево для ускорения просчета рейкаста\n    mainMesh.subdivide(128);\n    mainMesh.createOrUpdateSubmeshesOctree();\n\n    // Фризим матрицы (т.к фигура статична)\n    mainMashBackSide.freezeWorldMatrix();\n    mainMesh.freezeWorldMatrix();\n\n    // Это тоже нам не надо\n    mainMashBackSide.doNotSyncBoundingInfo = true;\n    mainMesh.doNotSyncBoundingInfo = true;\n  }\n\n  /**\n   * Нарисовать точку в месте прикосновения кисти (ЭКСПЕРИМЕНТАЛЬНО)\n   * @param pickInfo\n   * @param color\n   */\n  drawPointRaw(pickInfo, color) {\n    const x = pickInfo.getTextureCoordinates().x * this.textureSize;\n    const y = pickInfo.getTextureCoordinates().y * this.textureSize;\n\n    const dotSize = 16;\n    const dotSizeN2 = dotSize * dotSize;\n    const dotSizeH2 = dotSize / 2;\n\n    const data = new Uint8ClampedArray(dotSizeN2 * 4);\n    for (let i = 0; i < dotSizeN2; i += 1) {\n      data[4 * i] = ~~(color.r * 255);\n      data[4 * i + 1] = ~~(color.g * 255);\n      data[4 * i + 2] = ~~(color.b * 255);\n      data[4 * i + 3] = 255;\n    }\n    const redDot = new ImageData(data, dotSize, dotSize);\n    this.meshDrawTexture.getContext().putImageData(redDot, x - dotSizeH2, y - dotSizeH2);\n    this.meshDrawTexture.update(false);\n  }\n\n  /**\n   * Нарисовать точку в месте прикосновения кисти\n   * @param pickInfo\n   * @param color\n   */\n  drawPoint(pickInfo, color) {\n    const x = pickInfo.getTextureCoordinates().x * this.textureSize;\n    const y = pickInfo.getTextureCoordinates().y * this.textureSize;\n\n    const ctx = this.meshDrawTexture.getContext();\n\n    if (!color.colorString) {\n      color.colorString = `rgb(${~~(color.r * 255)},${~~(color.g * 255)},${~~(color.b * 255)})`;\n    }\n\n    // Радиус (подгоняется под размер кисти)\n    const radius = this.textureSize / 400;\n\n    ctx.fillStyle = color.colorString;\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, 2 * Math.PI);\n    ctx.fill();\n  }\n\n  /**\n   * Инициализация камеры следующей за кистью для режима езды\n   */\n  initDriveCamera() {\n    const camera = new BABYLON.UniversalCamera(\n      'drive-camera',\n      new BABYLON.Vector3(0, 0, 0),\n      this.scene,\n    );\n    this.driveCamera = camera;\n    camera.cameraAcceleration = 0.05;\n    camera.checkCollisions = false;\n\n    // Не реагирует на клаву и мышь\n    camera.inputs.clear();\n\n    // Находится над кистью позади неё (как в GTA)\n    camera.position.y = 5;\n    camera.position.z = -5;\n\n    // Смотрим на кисть\n    camera.rotation = new BABYLON.Vector3(Math.PI / 5, 0.005499999999999996, 0);\n  }\n\n  /**\n   * Инициализация альтернативной камеры следующей за кистью для режима езды\n   */\n  initDriveArcCamera() {\n    const camera = new BABYLON.ArcRotateCamera(\n      'drive-arc-camera',\n      -7.8836942647442125, // Alpha\n      0.3592756568269219, // Beta\n      0,\n      new BABYLON.Vector3(0, 20, 0), // Позиция над фигурой\n      this.scene,\n    );\n    this.driveArcCamera = camera;\n    camera.cameraAcceleration = 0.05;\n    camera.zoomOnFactor = 0.01;\n    camera.checkCollisions = false;\n  }\n\n  /**\n   * Инициализация камеры свободного вращения для режима свободного рисования\n   */\n  initFreeCamera() {\n    const camera = new BABYLON.ArcRotateCamera(\n      'free-camera',\n      0.75,\n      1.2,\n      60,\n      BABYLON.Vector3.Zero(),\n      this.scene,\n    );\n    this.freeCamera = camera;\n\n    // Убираем ограничения вращения\n    camera.lowerBetaLimit = null;\n    camera.upperBetaLimit = null;\n\n    camera.lowerRadiusLimit = 15;\n    camera.upperRadiusLimit = 100;\n\n    camera.useBouncingBehavior = true;\n  }\n\n  applyRenderPipeline() {\n    const pipeline = new BABYLON.DefaultRenderingPipeline(\n      'default-pipeline',\n      true,\n      this.scene,\n      [this.freeCamera, this.driveCamera, this.driveArcCamera], // The list of cameras to be attached to\n    );\n    this.renderPipeline = pipeline;\n\n    if (!this.lowGraphics) {\n      pipeline.chromaticAberrationEnabled = true;\n      pipeline.chromaticAberration.aberrationAmount = 15.7;\n      pipeline.chromaticAberration.radialIntensity = 0.8;\n\n      pipeline.fxaaEnabled = true;\n\n      pipeline.glowLayerEnabled = true;\n      pipeline.glowLayer.blurKernelSize = 16;\n      pipeline.glowLayer.intensity = 0.1;\n\n      pipeline.glowLayerEnabled = true;\n\n      pipeline.imageProcessingEnabled = true;\n      pipeline.imageProcessing.contrast = 1.1;\n      pipeline.imageProcessing.exposure = 1.1;\n\n      pipeline.imageProcessing.vignetteEnabled = true;\n      pipeline.imageProcessing.vignetteWeight = 0.1;\n      pipeline.imageProcessing.vignetteStretch = 0.1;\n      pipeline.imageProcessing.vignetteCameraFov = 0.3;\n\n      pipeline.depthOfFieldEnabled = true;\n      pipeline.depthOfField.focalLength = 2735;\n      pipeline.depthOfField.fStop = 16.9;\n      pipeline.depthOfField.focusDistance = 7169;\n      pipeline.depthOfField.lensSize = 38;\n\n      pipeline.grainEnabled = true;\n      pipeline.grain.intensity = 2;\n      pipeline.grain.animated = false;\n    }\n  }\n\n  async init() {\n    const scene = new BABYLON.Scene(this.engine);\n    this.scene = scene;\n\n    // Для быстрого доступа к сцене и отладки\n    window.s = scene;\n\n    scene.clearColor = BABYLON.Color3.FromHexString(this.visualOptions.clearColor);\n\n    const env = scene.createDefaultEnvironment({\n      enableGroundShadow: false,\n      skyboxSize: 200,\n      groundSize: 0,\n      skyboxColor: BABYLON.Color3.FromHexString(this.visualOptions.clearColor),\n    });\n    env.rootMesh.isPickable = false;\n    env.skybox.isPickable = false;\n\n    // Добавляем главный свет\n    const mainLight = new BABYLON.HemisphericLight('Hemi', new BABYLON.Vector3(0, 1, 0), scene);\n    this.mainLight = mainLight;\n    mainLight.intensity = 0.05;\n\n    this.initFreeCamera();\n\n    this.initDriveCamera();\n    this.initDriveArcCamera();\n\n    this.applyRenderPipeline();\n\n    // Свет камеры\n    this.cameraLight = new BABYLON.PointLight('camera-light', new BABYLON.Vector3.Zero(), scene);\n    this.cameraLight.intensity = 0.43;\n\n    await this.initMainMesh('duck');\n\n    const colors = [\n      colorPalette[8],\n      colorPalette[9],\n      colorPalette[11],\n      colorPalette[12],\n      colorPalette[13],\n      colorPalette[14],\n      colorPalette[15],\n    ];\n    this.brushes = [];\n\n    const brushSrc = BABYLON.Mesh.CreateBox('brush', 0.5, scene);\n    // Морфим фигуру под нужные размеры\n    brushSrc.bakeTransformIntoVertices(BABYLON.Matrix.Translation(0, 0.25, 0));\n    brushSrc.bakeTransformIntoVertices(BABYLON.Matrix.Scaling(1, 0.5, 1));\n\n    for (let i = 0; i < this.totalBrushes; i += 1) {\n      const colorHex = colors[i % colors.length];\n      const color = BABYLON.Color3.FromHexString(colorHex);\n\n      this.brushes.push(\n        new Brush({\n          mainScene: this,\n          index: i,\n          withParticles: !window.isMobile,\n          color,\n          angle: ((Math.PI * 2) / this.totalBrushes) * i,\n          brushSrc,\n        }),\n      );\n    }\n    this.brushes[0].isActive = true;\n\n    // Для прикола! Если фигур много, ставим последней режим змеи\n    if (this.totalBrushes >= 5) {\n      this.brushes[this.totalBrushes - 1].snakeMode = true;\n    }\n\n    this.initControl();\n\n    // Триггерим событие смены режима\n    this.setPlayMode(this.playMode);\n\n    this.sceneInstrumentation = new BABYLON.SceneInstrumentation(this.scene);\n\n    scene.registerBeforeRender(() => {\n      this.update();\n    });\n\n    scene.registerAfterRender(() => {\n      this._realTime = Date.now();\n      if (this._prevRealTime) {\n        const timeDiff = (this._realTime - this._prevRealTime) / 1000;\n        this.time += timeDiff;\n        this.timeDiff = timeDiff;\n      }\n      this._prevRealTime = this._realTime;\n\n      this.tick += 1;\n    });\n\n    return scene;\n  }\n\n  update() {\n    // Синхронизируем положение света камеры\n    this.cameraLight.position = this.scene.activeCamera.globalPosition;\n\n    // Выполняем логику обновления по всем кистям\n    for (let i = 0; i < this.brushes.length; i += 1) {\n      this.brushes[i].update();\n    }\n\n    // Грузим обновления по текстурке в видяху\n    this.meshDrawTexture.update(false);\n  }\n\n  render() {\n    this.scene.render();\n  }\n\n  setPlayMode(mode) {\n    this.playMode = mode;\n\n    // Отвызываем контроль с текущей камеры (она поменяется)\n    if (this.scene.activeCamera) {\n      this.scene.activeCamera.detachControl(this.canvas);\n    }\n\n    switch (mode) {\n      case 'FREE': {\n        this.scene.activeCamera = this.freeCamera;\n        if (this.renderPipeline) {\n          this.renderPipeline.depthOfFieldEnabled = false;\n        }\n        break;\n      }\n      case 'DRIVE': {\n        if (this.driveCameraMode === 'CLASSIC') {\n          this.scene.activeCamera = this.driveCamera;\n          if (this.renderPipeline) {\n            this.renderPipeline.depthOfFieldEnabled = !this.lowGraphics;\n          }\n        } else if (this.driveCameraMode === 'ARC') {\n          this.scene.activeCamera = this.driveArcCamera;\n          if (this.renderPipeline) {\n            this.renderPipeline.depthOfFieldEnabled = false;\n          }\n        }\n\n        break;\n      }\n      default:\n    }\n\n    // Привязываем контроль к новой активной камере\n    this.scene.activeCamera.attachControl(this.canvas, true);\n\n    for (let i = 0; i < this.brushes.length; i += 1) {\n      // Извещаем кисти о смене режима\n      this.brushes[i].handleChangePlayMode(this.playMode);\n    }\n  }\n\n  changeDriveCameraMode(driveCameraMode) {\n    if (this.playMode !== 'DRIVE') {\n      return;\n    }\n\n    if (!driveCameraMode) {\n      if (this.driveCameraMode === 'CLASSIC') {\n        driveCameraMode = 'ARC';\n      } else {\n        driveCameraMode = 'CLASSIC';\n      }\n    }\n\n    this.driveCameraMode = driveCameraMode;\n    this.setPlayMode(this.playMode);\n  }\n\n  /**\n   * Остановить рендер\n   * @param val\n   */\n  stop(val = true) {\n    this._prevRealTime = Date.now();\n\n    this.isStopped = val;\n\n    this.resetActiveKeys();\n  }\n\n  /**\n   * Поставить на паузу (для режима DRIVE)\n   * @param val\n   */\n  pause(val = true) {\n    this._prevRealTime = Date.now();\n\n    this.isPaused = val;\n\n    this.resetActiveKeys();\n  }\n\n  /**\n   * Сбросить состояние нажатых кнопок\n   */\n  resetActiveKeys() {\n    Object.keys(this.activeKeys).forEach(k => delete this.activeKeys[k]);\n  }\n}\nexport default MainScene;\n","import React, { useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport styles from './styles.module.scss';\n\nconst MobileControlHelper = ({ mainSceneRef }) => {\n  // Up\n  const handlePressUp = useCallback(() => {\n    mainSceneRef.current.activeKeys.ArrowUp = true;\n  }, [mainSceneRef]);\n  const handleUnPressUp = useCallback(() => {\n    mainSceneRef.current.activeKeys.ArrowUp = false;\n  }, [mainSceneRef]);\n\n  // Left\n  const handlePressLeft = useCallback(() => {\n    mainSceneRef.current.activeKeys.ArrowLeft = true;\n  }, [mainSceneRef]);\n  const handleUnPressLeft = useCallback(() => {\n    mainSceneRef.current.activeKeys.ArrowLeft = false;\n  }, [mainSceneRef]);\n\n  // Right\n  const handlePressRight = useCallback(() => {\n    mainSceneRef.current.activeKeys.ArrowRight = true;\n  }, [mainSceneRef]);\n  const handleUnPressRight = useCallback(() => {\n    mainSceneRef.current.activeKeys.ArrowRight = false;\n  }, [mainSceneRef]);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.topContent}>\n        <div\n          role=\"presentation\"\n          className={styles.button}\n          onMouseDown={handlePressUp}\n          onMouseUp={handleUnPressUp}\n          onTouchStart={handlePressUp}\n          onTouchEnd={handleUnPressUp}\n        />\n      </div>\n      <div className={styles.bottomContent}>\n        <div\n          role=\"presentation\"\n          className={styles.button}\n          onMouseDown={handlePressLeft}\n          onMouseUp={handleUnPressLeft}\n          onTouchStart={handlePressLeft}\n          onTouchEnd={handleUnPressLeft}\n        />\n        <div\n          role=\"presentation\"\n          className={styles.button}\n          onMouseDown={handlePressRight}\n          onMouseUp={handleUnPressRight}\n          onTouchStart={handlePressRight}\n          onTouchEnd={handleUnPressRight}\n        />\n      </div>\n    </div>\n  );\n};\n\nMobileControlHelper.protoTypes = {\n  mainSceneRef: PropTypes.object,\n};\n\nexport default MobileControlHelper;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"g\", null, React.createElement(\"g\", null, React.createElement(\"g\", null, React.createElement(\"circle\", {\n  cx: 256,\n  cy: 378.5,\n  r: 25\n}), React.createElement(\"path\", {\n  d: \"M256,0C114.516,0,0,114.497,0,256c0,141.484,114.497,256,256,256c141.484,0,256-114.497,256-256 C512,114.516,397.503,0,256,0z M256,472c-119.377,0-216-96.607-216-216c0-119.377,96.607-216,216-216 c119.377,0,216,96.607,216,216C472,375.377,375.393,472,256,472z\"\n}), React.createElement(\"path\", {\n  d: \"M256,128.5c-44.112,0-80,35.888-80,80c0,11.046,8.954,20,20,20s20-8.954,20-20c0-22.056,17.944-40,40-40 c22.056,0,40,17.944,40,40c0,22.056-17.944,40-40,40c-11.046,0-20,8.954-20,20v50c0,11.046,8.954,20,20,20 c11.046,0,20-8.954,20-20v-32.531c34.466-8.903,60-40.26,60-77.469C336,164.388,300.112,128.5,256,128.5z\"\n}))));\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref4 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref5 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref6 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref7 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref8 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref9 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref10 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref11 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref12 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref13 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref14 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref15 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref16 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref17 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar SvgQuestion = function SvgQuestion(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    id: \"Capa_1\",\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 512 512\",\n    style: {\n      enableBackground: \"new 0 0 512 512\"\n    },\n    xmlSpace: \"preserve\",\n    fill: \"currentColor\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10, _ref11, _ref12, _ref13, _ref14, _ref15, _ref16, _ref17);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgQuestion, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/question.5eac3b27.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react';\nimport { useSelector } from 'react-redux';\nimport styles from './styles.module.scss';\nimport { ReactComponent as HelpIcon } from './icons/question.svg';\n\nconst ControlHint = () => {\n  const mode = useSelector(state => state.uiSettings.mode);\n\n  return (\n    <div className={styles.container}>\n      {mode === 'DRIVE' && (\n        <>\n          Control:<b>A</b> - Turn left; <b>D</b> - Turn right; <b>W</b> - Speed up; <b>Tab</b> -\n          Change camera\n        </>\n      )}\n\n      {mode === 'FREE' && (\n        <>\n          <HelpIcon className={styles.icon} /> Control: <b>Left mouse + move</b> - Draw;{' '}\n          <b>Middle mouse + move</b> - Rotate\n        </>\n      )}\n    </div>\n  );\n};\n\nControlHint.protoTypes = {};\n\nexport default ControlHint;\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport * as BABYLON from 'babylonjs';\nimport 'babylonjs-loaders';\nimport styles from './styles.module.scss';\nimport ControlPanel from '@/components/pages/DrawPage/ControlPanel/ControlPanel';\nimport LoadingPage from '@/components/common/LoadingPage/LoadingPage';\nimport MainScene from '@/components/pages/DrawPage/graphics/MainScene';\nimport { useKeyPressHandler, useWindowFocus } from '@/utils/hooks';\nimport MobileControlHelper from './MobileControlHelper/MobileControlHelper';\nimport ControlHint from './ControlHint/ControlHint';\n\nconst DrawPage = () => {\n  const [isReady, setIsReady] = useState(false);\n\n  const canvasRef = useRef(null);\n  const mainSceneRef = useRef(null);\n  const engineRef = useRef(null);\n\n  const [gamePaused, setGamePaused] = useState(true);\n\n  const mode = useSelector(state => state.uiSettings.mode);\n  const modeRef = useRef(mode);\n\n  useEffect(() => {\n    modeRef.current = mode;\n\n    if (mode === 'DRIVE') {\n      setGamePaused(true);\n    } else if (mode === 'FREE') {\n      setGamePaused(false);\n    }\n  }, [mode]);\n\n  useEffect(() => {\n    (async () => {\n      const canvas = canvasRef.current;\n\n      // Инициализировать движок\n      const engine = new BABYLON.Engine(canvas, true, {\n        preserveDrawingBuffer: true,\n        stencil: true,\n      });\n      engineRef.current = engine;\n\n      // Создаем главную сцену\n      const mainScene = new MainScene({\n        engine,\n        canvas,\n      });\n      mainSceneRef.current = mainScene;\n      await mainScene.init();\n\n      setIsReady(true);\n\n      engine.runRenderLoop(() => {\n        if (!mainScene.isStopped) {\n          mainScene.render();\n        }\n      });\n    })();\n\n    const handleWindowResize = () => {\n      engineRef.current.resize();\n    };\n\n    window.addEventListener('resize', handleWindowResize);\n\n    return () => {\n      engineRef.current.dispose();\n      window.removeEventListener('resize', handleWindowResize);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (!isReady) {\n      return;\n    }\n\n    mainSceneRef.current.setPlayMode(mode);\n  }, [mode, isReady]);\n\n  const tabIsFocused = useWindowFocus();\n  useEffect(() => {\n    if (!tabIsFocused) {\n      setGamePaused(true);\n    }\n  }, [tabIsFocused]);\n\n  const keyPressHandler = useCallback(\n    e => {\n      if (e.key === 'Space' || e.which === 32 || e.key === 'Escape' || e.which === 27) {\n        setGamePaused(!gamePaused);\n      }\n      if (e.key === 'Tab' || e.which === 9) {\n        // Отключаем TAB\n        e.preventDefault();\n\n        mainSceneRef.current.changeDriveCameraMode();\n      }\n    },\n    [gamePaused],\n  );\n  useKeyPressHandler(keyPressHandler);\n\n  // При нажатии на паузу - снимаем с паузы\n  const handleClickPauseMessage = useCallback(() => {\n    setGamePaused(false);\n  }, [setGamePaused]);\n\n  useEffect(() => {\n    // Дергаем метод сцены для остановки/запуска движения\n    mainSceneRef.current.pause(gamePaused);\n  }, [gamePaused]);\n\n  useEffect(() => {\n    // При смене режима всегда фокус на канвас\n    canvasRef.current.focus();\n  }, [gamePaused, mode]);\n\n  const controlPanelIsOpen = useSelector(state => state.uiSettings.controlPanelIsOpen);\n\n  return (\n    <div className={styles.page}>\n      {!isReady && (\n        <div className={styles.loadingOverlay}>\n          <LoadingPage />\n        </div>\n      )}\n      <canvas ref={canvasRef} className={styles.mainCanvas} tabIndex=\"0\" />\n      <ControlPanel isOpen={controlPanelIsOpen} />\n\n      {mode === 'DRIVE' && window.isMobile && <MobileControlHelper mainSceneRef={mainSceneRef} />}\n\n      {gamePaused && mode === 'DRIVE' && (\n        <div className={styles.pauseMessage} role=\"presentation\" onClick={handleClickPauseMessage}>\n          <div className={styles.content}>\n            {window.isMobile ? 'Tap to start' : 'Press SPACE to start'}\n          </div>\n        </div>\n      )}\n\n      {!window.isMobile && <ControlHint />}\n    </div>\n  );\n};\n\nDrawPage.protoTypes = {};\n\nexport default DrawPage;\n","import { useState, useEffect } from 'react';\n\n/**\n * Обработчик смены фокуса окна\n * @returns {*}\n */\nexport function useWindowFocus() {\n  const [isFocused, setIsFocused] = useState(document.hasFocus());\n\n  useEffect(() => {\n    const handleFocus = () => {\n      setIsFocused(true);\n    };\n    const handleBlur = () => {\n      setIsFocused(false);\n    };\n\n    window.addEventListener('focus', handleFocus);\n    window.addEventListener('blur', handleBlur);\n    return () => {\n      window.removeEventListener('focus', handleFocus);\n      window.removeEventListener('blur', handleBlur);\n    };\n  }, [setIsFocused]);\n\n  return isFocused;\n}\n\n/**\n * Обраточик нажатия кнопки\n * @param onKeyPress\n */\nexport function useKeyPressHandler(onKeyPress) {\n  useEffect(() => {\n    function downHandler(e) {\n      onKeyPress(e, e.key, e.which === 32);\n    }\n\n    window.addEventListener('keydown', downHandler);\n\n    return () => {\n      window.removeEventListener('keydown', downHandler);\n    };\n  }, [onKeyPress]);\n}\n","import React from 'react';\nimport { HashRouter as Router, Switch, Route, Redirect } from 'react-router-dom';\nimport MainLayout from '@/components/layouts/MainLayout/MainLayout';\nimport DrawPage from '@/components/pages/DrawPage/DrawPage';\n\nconst App = () => {\n  return (\n    <Router>\n      <MainLayout>\n        <Switch>\n          {/* Основная страница */}\n          <Route exact path=\"/\" component={DrawPage} />\n\n          {/* Всё остальное - редиректим на основную */}\n          <Redirect to=\"/\" />\n        </Switch>\n      </MainLayout>\n    </Router>\n  );\n};\n\nexport default App;\n"],"sourceRoot":""}